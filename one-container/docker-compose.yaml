version: '2'

volumes:
  etc_pihole-unbound:
  etc_pihole_dnsmasq-unbound:

services:
  pihole:
    container_name: pihole
    image: cbcrowe/pihole-unbound:latest
    hostname: ${HOSTNAME}
    domainname: ${DOMAIN_NAME}
    networks:
      macvlan_network:
        ipv4_address: 100.64.0.5
  # network_mode: "host"   #for host network
    cap_add:  #for host and macvlan network
      - NET_ADMIN  #for host and macvlan network
  # ports:
    # - 443:443/tcp
    # - 53:53/tcp
    # - 53:53/udp
    # - 80:80/tcp
    # - 67:67/udp
    # - 67:67/tcp
    # - 5335:5335/tcp # Uncomment to enable unbound access on local server
    # - 22/tcp # Uncomment to enable SSH
    environment:
      ServerIP: ${ServerIP}
      TZ: ${TZ}
      WEBPASSWORD: ${WEBPASSWORD}
      REV_SERVER: ${REV_SERVER}
      REV_SERVER_TARGET: ${REV_SERVER_TARGET}
      REV_SERVER_DOMAIN: ${REV_SERVER_DOMAIN}
      REV_SERVER_CIDR: ${REV_SERVER_CIDR}
      DNS1: 127.0.0.1#5335 # Hardcoded to our Unbound server
      DNS2: 127.0.0.1#5335 # Hardcoded to our Unbound server
      DNSSEC: "true" # Enable DNSSEC
    volumes:
      - etc_pihole-unbound:/etc/pihole:rw
      - etc_pihole_dnsmasq-unbound:/etc/dnsmasq.d:rw
    restart: unless-stopped
networks:
  macvlan_network:
    external:
      name: mynet
    
